module AESDecryptor
  extend ActiveSupport::Concern

  def decrypt_body(body, iv, device)
    cipher = OpenSSL::Cipher::AES128.new(:CBC)
    cipher.decrypt
    cipher.key = device.key
    cipher.iv = iv

    return cipher.update(body) + cipher.final
  end

  def encrypt_body(body, device)
    cipher = OpenSSL::Cipher::AES128.new(:CBC)
    cipher.encrypt
    cipher.key = device.key
    iv = cipher.random_iv

    return {body: cipher.update(body) + cipher.final, iv: iv}
  end

end
